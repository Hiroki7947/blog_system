{% extends 'base.html' %}
{% block title %}{{ article.title }}{% endblock %}
{% block content %}
<h2>{{ article.title }}</h2>
<p class="text-muted">投稿者: {{ article.author.username }} ｜ 投稿日: {{ article.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
<div class="border rounded p-3 mb-3 bg-white">
  <p style="white-space: pre-line;">{{ article.body }}</p>
</div>

{% if current_user.is_authenticated and article.user_id == current_user.id %}
  <a href="{{ url_for('edit_article', article_id=article.id) }}" class="btn btn-warning btn-sm">編集</a>
{% endif %}

<hr>
<h4 class="mt-4">コメント</h4>

{% for c in article.comments %}
  <div class="border rounded p-2 mb-2 bg-light">
    <p style="white-space: pre-line;">{{ c.body }}</p>
    <p class="text-muted small">投稿者: {{ c.author.username }} ｜ {{ c.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
  </div>
{% else %}
  <p>まだコメントはありません。</p>
{% endfor %}

{% if current_user.is_authenticated %}
<form method="POST" action="{{ url_for('add_comment', article_id=article.id) }}" class="mt-3">
  <div class="mb-3">
    <textarea name="body" rows="3" class="form-control" placeholder="コメントを入力..." required></textarea>
  </div>
  <button class="btn btn-secondary">コメント投稿</button>
</form>
{% else %}
  <p><a href="{{ url_for('login') }}">ログイン</a>するとコメントできます。</p>
{% endif %}
{% endblock %}
